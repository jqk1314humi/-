<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>激活码功能测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button {
            background: #6366f1;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #4f46e5;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success { background: #d1fae5; color: #065f46; }
        .error { background: #fee2e2; color: #991b1b; }
        .info { background: #dbeafe; color: #1e40af; }
        
        .status-section {
            margin: 15px 0;
        }
        
        .status-section h4 {
            margin: 10px 0 5px 0;
            color: #374151;
            font-size: 14px;
        }
        
        .code-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 8px;
            margin: 10px 0;
        }
        
        .code-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
            background: #f9fafb;
        }
        
        .code-item.current {
            background: #d1fae5;
            border-color: #10b981;
        }
        
        .code-item.used {
            background: #fef3c7;
            border-color: #f59e0b;
        }
        
        .code-item.unused {
            background: #f3f4f6;
            border-color: #d1d5db;
        }
        
        .code-item code {
            font-family: 'Courier New', monospace;
            font-size: 12px;
            background: rgba(0,0,0,0.1);
            padding: 2px 6px;
            border-radius: 3px;
        }
        
        .badge {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: 500;
        }
        
        .badge.current {
            background: #10b981;
            color: white;
        }
        
        .badge.used {
            background: #f59e0b;
            color: white;
        }
        
        .badge.unused {
            background: #6b7280;
            color: white;
        }
        
        .badge:not(.current):not(.used):not(.unused) {
            background: #6366f1;
            color: white;
        }
    </style>
</head>
<body>
    <h1>智能导员激活码功能测试</h1>
    
    <div class="test-section">
        <h2>测试说明</h2>
        <p>这个页面用于测试激活码功能是否正常工作。</p>
        <p>请按照以下步骤进行测试：</p>
        <ol>
            <li>点击"清除激活状态"按钮</li>
            <li>点击"打开主程序"按钮</li>
            <li>检查是否弹出激活码输入框</li>
            <li>输入激活码进行测试</li>
        </ol>
    </div>

    <div class="test-section">
        <h2>测试操作</h2>
        <button onclick="clearActivation()">清除激活状态</button>
        <button onclick="openMainApp()">打开主程序</button>
        <button onclick="checkActivationStatus()">检查激活状态</button>
        <button onclick="showActivationModal()">手动显示激活码框</button>
        <button onclick="updateActivationStatus()">刷新状态</button>
    </div>

    <div class="test-section">
        <h2>激活码列表</h2>
        <h3>开发者激活码（可重复使用）</h3>
        <code>jqkkf0922</code>
        
        <h3>普通激活码（每个限用一次）</h3>
        <ul>
            <li><code>j6si0f26cig0</code></li>
            <li><code>polex311eo4e</code></li>
            <li><code>gwhfntmgol8l</code></li>
            <li><code>sej5z1hhleqf</code></li>
            <li><code>2ta1zchbuj8v</code></li>
            <li><code>6uwqby0nk0fv</code></li>
            <li><code>jza4m0okaflj</code></li>
            <li><code>5n51yax303tm</code></li>
            <li><code>by8fahc1taa3</code></li>
            <li><code>v61g1yyvbgg6</code></li>
        </ul>
    </div>

    <div class="test-section">
        <h2>激活码使用状态</h2>
        <div id="lastUpdate" style="font-size: 12px; color: #6b7280; margin-bottom: 10px;"></div>
        <div id="activationStatus"></div>
    </div>

    <div class="test-section">
        <h2>测试结果</h2>
        <div id="testResults"></div>
    </div>

    <script>
        function clearActivation() {
            localStorage.removeItem('smartAdvisorActivation');
            localStorage.removeItem('smartAdvisorUsedCodes');
            showResult('激活状态已清除', 'success');
            updateActivationStatus();
        }

        function openMainApp() {
            window.open('index.html', '_blank');
            showResult('主程序已打开，请检查是否显示激活码输入框', 'info');
        }

        function checkActivationStatus() {
            const activationData = localStorage.getItem('smartAdvisorActivation');
            if (activationData) {
                try {
                    const data = JSON.parse(activationData);
                    showResult(`激活状态：已激活 (${data.isDeveloper ? '开发者' : '普通用户'})`, 'success');
                } catch (e) {
                    showResult('激活状态：数据损坏', 'error');
                }
            } else {
                showResult('激活状态：未激活', 'info');
            }
            updateActivationStatus();
        }

        function updateActivationStatus() {
            const statusDiv = document.getElementById('activationStatus');
            if (!statusDiv) return;

            // 获取已使用的激活码
            const usedCodes = JSON.parse(localStorage.getItem('smartAdvisorUsedCodes') || '[]');
            
            // 获取当前激活的激活码
            const activationData = localStorage.getItem('smartAdvisorActivation');
            let currentCode = null;
            let isDeveloper = false;
            
            if (activationData) {
                try {
                    const data = JSON.parse(activationData);
                    currentCode = data.code;
                    isDeveloper = data.isDeveloper;
                } catch (e) {
                    console.error('解析激活数据失败:', e);
                }
            }

            // 所有激活码列表
            const allCodes = [
                'j6si0f26cig0',
                'polex311eo4e', 
                'gwhfntmgol8l',
                'sej5z1hhleqf',
                '2ta1zchbuj8v',
                '6uwqby0nk0fv',
                'jza4m0okaflj',
                '5n51yax303tm',
                'by8fahc1taa3',
                'v61g1yyvbgg6'
            ];

            let html = '<div class="status-section">';
            
            // 显示当前激活状态
            if (currentCode) {
                html += `<div class="status success">`;
                html += `<strong>当前激活码：</strong> ${currentCode}`;
                if (isDeveloper) {
                    html += ` <span class="badge">开发者</span>`;
                }
                html += `</div>`;
            } else {
                html += `<div class="status info">未激活</div>`;
            }

            // 显示已使用的激活码
            if (usedCodes.length > 0) {
                html += `<div class="status-section">`;
                html += `<h4>已使用的激活码 (${usedCodes.length}个)：</h4>`;
                html += `<div class="code-list">`;
                usedCodes.forEach(code => {
                    const isCurrent = code === currentCode;
                    html += `<div class="code-item ${isCurrent ? 'current' : 'used'}">`;
                    html += `<code>${code}</code>`;
                    if (isCurrent) {
                        html += ` <span class="badge current">当前使用</span>`;
                    } else {
                        html += ` <span class="badge used">已使用</span>`;
                    }
                    html += `</div>`;
                });
                html += `</div></div>`;
            }

            // 显示未使用的激活码
            const unusedCodes = allCodes.filter(code => !usedCodes.includes(code));
            if (unusedCodes.length > 0) {
                html += `<div class="status-section">`;
                html += `<h4>未使用的激活码 (${unusedCodes.length}个)：</h4>`;
                html += `<div class="code-list">`;
                unusedCodes.forEach(code => {
                    html += `<div class="code-item unused">`;
                    html += `<code>${code}</code>`;
                    html += ` <span class="badge unused">未使用</span>`;
                    html += `</div>`;
                });
                html += `</div></div>`;
            }

            html += '</div>';
            statusDiv.innerHTML = html;
            
            // 更新最后更新时间
            const lastUpdateDiv = document.getElementById('lastUpdate');
            if (lastUpdateDiv) {
                lastUpdateDiv.textContent = `最后更新：${new Date().toLocaleString()}`;
            }
        }

        function showActivationModal() {
            // 这个方法需要在主程序中定义
            if (window.showActivationModal) {
                window.showActivationModal();
                showResult('已尝试显示激活码模态框', 'info');
            } else {
                showResult('请先打开主程序', 'error');
            }
        }

        function showResult(message, type) {
            const results = document.getElementById('testResults');
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
            results.appendChild(div);
            results.scrollTop = results.scrollHeight;
        }

        // 页面加载时检查状态
        window.onload = function() {
            checkActivationStatus();
            updateActivationStatus();
            
            // 每5秒自动刷新一次状态
            setInterval(updateActivationStatus, 5000);
        };
    </script>
</body>
</html>
