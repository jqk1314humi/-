<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµ‹è¯•Outputå­—æ®µä¼˜å…ˆçº§</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .result {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        .success { border-left: 4px solid #28a745; }
        .error { border-left: 4px solid #dc3545; }
        .info { border-left: 4px solid #17a2b8; }
        .warning { border-left: 4px solid #ffc107; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .mock-data {
            background: #e9ecef;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>æµ‹è¯•Outputå­—æ®µä¼˜å…ˆçº§å¤„ç†</h1>
        
        <div class="test-section">
            <h3>ä¿®æ”¹è¯´æ˜</h3>
            <div class="mock-data">
                <strong>æ–°çš„ä¼˜å…ˆçº§é¡ºåºï¼š</strong><br>
                output5 > output4 > output3 > output2 > output<br><br>
                <strong>ä¿®æ”¹ä½ç½®ï¼š</strong> public/advisor.js ä¸­çš„ callCozeAPIStream æ–¹æ³•<br>
                <strong>åŠŸèƒ½ï¼š</strong> æ™ºèƒ½å¯¼å‘˜ä¼šæŒ‰ç…§æ–°çš„ä¼˜å…ˆçº§é¡ºåºé€‰æ‹©APIè¿”å›çš„å†…å®¹
            </div>
        </div>

        <div class="test-section">
            <h3>æ¨¡æ‹Ÿæµ‹è¯•ä¸åŒçš„APIå“åº”</h3>
            <button onclick="testOutputPriority()">æµ‹è¯•Outputå­—æ®µä¼˜å…ˆçº§</button>
            <div id="testResult" class="result"></div>
        </div>

        <div class="test-section">
            <h3>å®é™…APIæµ‹è¯•</h3>
            <p>è¦æµ‹è¯•å®é™…æ•ˆæœï¼Œè¯·ï¼š</p>
            <ol>
                <li>æ‰“å¼€æ™ºèƒ½å¯¼å‘˜ç•Œé¢ (advisor.html)</li>
                <li>å‘é€ä¸€ä¸ªæ¶ˆæ¯ç»™AI</li>
                <li>æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å° (F12)</li>
                <li>æŸ¥çœ‹æ—¥å¿—ä¸­æ˜¾ç¤ºçš„"å¯ç”¨çš„outputå­—æ®µ"å’Œ"ä½¿ç”¨xxxå­—æ®µ"ä¿¡æ¯</li>
            </ol>
            <a href="advisor.html" target="_blank">
                <button>æ‰“å¼€æ™ºèƒ½å¯¼å‘˜æµ‹è¯•</button>
            </a>
        </div>

        <div class="test-section">
            <h3>è°ƒè¯•ä¿¡æ¯è¯´æ˜</h3>
            <div class="mock-data">
                ä¿®æ”¹åçš„ä»£ç ä¼šåœ¨æ§åˆ¶å°è¾“å‡ºä»¥ä¸‹è°ƒè¯•ä¿¡æ¯ï¼š<br>
                â€¢ "å¯ç”¨çš„outputå­—æ®µ: [...]" - æ˜¾ç¤ºAPIå“åº”ä¸­åŒ…å«çš„æ‰€æœ‰outputå­—æ®µ<br>
                â€¢ "ä½¿ç”¨outputXå­—æ®µ: ..." - æ˜¾ç¤ºå®é™…é€‰æ‹©ä½¿ç”¨çš„å­—æ®µå’Œå†…å®¹é¢„è§ˆ<br>
                â€¢ "ç›´æ¥åœ¨dataä¸­å¯ç”¨çš„outputå­—æ®µ: [...]" - æ˜¾ç¤ºç›´æ¥åœ¨dataå¯¹è±¡ä¸­çš„outputå­—æ®µ<br>
                è¿™äº›ä¿¡æ¯å¸®åŠ©ç¡®è®¤ä¼˜å…ˆçº§é€‰æ‹©æ˜¯å¦æ­£ç¡®å·¥ä½œ
            </div>
        </div>
    </div>

    <script>
        function addResult(elementId, content, type = 'info') {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            element.innerHTML += `<div class="${type}">[${timestamp}] ${content}</div>`;
            element.scrollTop = element.scrollHeight;
        }

        // æ¨¡æ‹Ÿæµ‹è¯•outputå­—æ®µä¼˜å…ˆçº§é€»è¾‘
        function testOutputPriority() {
            addResult('testResult', 'å¼€å§‹æµ‹è¯•Outputå­—æ®µä¼˜å…ˆçº§é€»è¾‘...', 'info');
            
            // æ¨¡æ‹Ÿä¸åŒçš„APIå“åº”æ•°æ®
            const testCases = [
                {
                    name: 'åŒ…å«output5çš„å“åº”',
                    data: {
                        output: 'è¿™æ˜¯outputå†…å®¹',
                        output2: 'è¿™æ˜¯output2å†…å®¹',
                        output3: 'è¿™æ˜¯output3å†…å®¹',
                        output4: 'è¿™æ˜¯output4å†…å®¹',
                        output5: 'è¿™æ˜¯output5å†…å®¹ - åº”è¯¥è¢«ä¼˜å…ˆé€‰æ‹©'
                    },
                    expected: 'output5'
                },
                {
                    name: 'ç¼ºå°‘output5ï¼Œæœ‰output4',
                    data: {
                        output: 'è¿™æ˜¯outputå†…å®¹',
                        output2: 'è¿™æ˜¯output2å†…å®¹',
                        output3: 'è¿™æ˜¯output3å†…å®¹',
                        output4: 'è¿™æ˜¯output4å†…å®¹ - åº”è¯¥è¢«é€‰æ‹©'
                    },
                    expected: 'output4'
                },
                {
                    name: 'åªæœ‰output2å’Œoutput',
                    data: {
                        output: 'è¿™æ˜¯outputå†…å®¹',
                        output2: 'è¿™æ˜¯output2å†…å®¹ - åº”è¯¥è¢«é€‰æ‹©'
                    },
                    expected: 'output2'
                },
                {
                    name: 'åªæœ‰output',
                    data: {
                        output: 'è¿™æ˜¯outputå†…å®¹ - åº”è¯¥è¢«é€‰æ‹©'
                    },
                    expected: 'output'
                },
                {
                    name: 'åŒ…å«ç©ºå­—æ®µ',
                    data: {
                        output: 'è¿™æ˜¯outputå†…å®¹ - åº”è¯¥è¢«é€‰æ‹©',
                        output2: '',
                        output3: '   ',
                        output4: null,
                        output5: undefined
                    },
                    expected: 'output'
                }
            ];

            // å®ç°ä¸advisor.jsä¸­ç›¸åŒçš„ä¼˜å…ˆçº§é€»è¾‘
            function selectOutput(parsedData) {
                const availableOutputs = [];
                ['output5', 'output4', 'output3', 'output2', 'output'].forEach(field => {
                    if (parsedData[field] && parsedData[field].trim && parsedData[field].trim()) {
                        availableOutputs.push(field);
                    }
                });

                let content = '';
                let selectedField = null;
                
                if (parsedData.output5 && parsedData.output5.trim && parsedData.output5.trim()) {
                    content = parsedData.output5;
                    selectedField = 'output5';
                } else if (parsedData.output4 && parsedData.output4.trim && parsedData.output4.trim()) {
                    content = parsedData.output4;
                    selectedField = 'output4';
                } else if (parsedData.output3 && parsedData.output3.trim && parsedData.output3.trim()) {
                    content = parsedData.output3;
                    selectedField = 'output3';
                } else if (parsedData.output2 && parsedData.output2.trim && parsedData.output2.trim()) {
                    content = parsedData.output2;
                    selectedField = 'output2';
                } else if (parsedData.output && parsedData.output.trim && parsedData.output.trim()) {
                    content = parsedData.output;
                    selectedField = 'output';
                }

                return { content, selectedField, availableOutputs };
            }

            // æµ‹è¯•æ¯ä¸ªç”¨ä¾‹
            testCases.forEach((testCase, index) => {
                addResult('testResult', `\næµ‹è¯•ç”¨ä¾‹ ${index + 1}: ${testCase.name}`, 'info');
                
                const result = selectOutput(testCase.data);
                
                addResult('testResult', `å¯ç”¨å­—æ®µ: [${result.availableOutputs.join(', ')}]`, 'info');
                addResult('testResult', `é€‰æ‹©å­—æ®µ: ${result.selectedField}`, 'info');
                addResult('testResult', `å†…å®¹é¢„è§ˆ: ${result.content ? result.content.substring(0, 50) + '...' : 'æ— å†…å®¹'}`, 'info');
                
                if (result.selectedField === testCase.expected) {
                    addResult('testResult', `âœ… æµ‹è¯•é€šè¿‡ - æ­£ç¡®é€‰æ‹©äº† ${result.selectedField}`, 'success');
                } else {
                    addResult('testResult', `âŒ æµ‹è¯•å¤±è´¥ - æœŸæœ› ${testCase.expected}ï¼Œå®é™… ${result.selectedField}`, 'error');
                }
            });

            addResult('testResult', '\nğŸ‰ æ¨¡æ‹Ÿæµ‹è¯•å®Œæˆï¼è¯·åœ¨å®é™…æ™ºèƒ½å¯¼å‘˜ç•Œé¢ä¸­æµ‹è¯•çœŸå®APIå“åº”ã€‚', 'success');
        }
    </script>
</body>
</html>
